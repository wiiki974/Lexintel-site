<script>
  async function askLexiBot() {
    const question = document.getElementById("question").value.trim();
    const responseArea = document.getElementById("responseArea");

    if (!question) {
      alert("Merci de poser une question.");
      return;
    }

    responseArea.innerHTML = "<p><em>LexiBot réfléchit...</em></p>";

    try {
      const res = await fetch("https://lexintel-api.onrender.com/api", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ question })
      });

      const data = await res.json();
      const reply = data.answer;
      const parts = reply.split(/\d\.\s/).filter(Boolean);
      const titles = ["Résumé", "Ce que dit la loi", "Peine encourue", "Solutions possibles", "Étapes concrètes"];
      let html = "";

      for (let i = 0; i < titles.length; i++) {
        const section = parts[i] ? parts[i].trim() : "Non fourni.";
        html += `<details ${i < 2 ? "open" : ""}><summary>➕ ${titles[i]}</summary><div>${section}</div></details>`;
      }

      responseArea.innerHTML = html + "<p style='font-size:12px;color:#888;'>⚠️ Ceci est une réponse informative. Consulte un professionnel si nécessaire.</p>";
    } catch (err) {
      console.error(err);
      responseArea.innerHTML = "<p>❌ Erreur de connexion à l'API.</p>";
    }
  }
</script>
